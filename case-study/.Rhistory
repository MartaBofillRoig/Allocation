filter(arm == "a1") %>%
select(reject_h0)
e1_t1e <- sum(y1_t1e)/nsim
y2_t1e <- y_sqrt %>%
filter(arm == "a2") %>%
select(reject_h0)
e2_t1e <- sum(y2_t1e)/nsim
df_res[i,]=c(rt=e1_t1e,r1=N1/N,r2=N2/N,
mu0=mean_control,mu1=7,mu2=7,
N=N,alloc="sqrt",arm="a1",H0=F)
df_res[i+1,]=c(rt=e2_t1e,r1=N1/N,r2=N2/N,
mu0=mean_control,mu1=7,mu2=7,
N=N,alloc="sqrt",arm="a2",H0=F)
i=i+2
list_res_H1 = list(y,y_opt,y_sqrt)
##########################################
##########################################
# T1E comparison
##########################################
# 1:1 allocation
y = rdply(nsim,
do.call(rbind.data.frame,
models_cc(data = sim_designs(r1=N1/N,r2=N2/N,
mu0=mean_control,mu1=mean_control,mu2=mean_control,
N=N,alloc="one")$data
)
)
)
head(y)
# t1e / power
y1_t1e <- y %>%
filter(arm == "a1") %>%
select(reject_h0)
e1_t1e <- sum(y1_t1e)/nsim
y2_t1e <- y %>%
filter(arm == "a2") %>%
select(reject_h0)
e2_t1e <- sum(y2_t1e)/nsim
df_res[i,]=c(rt=e1_t1e,r1=N1/N,r2=N2/N,
mu0=mean_control,mu1=mean_control,mu2=mean_control,
N=N,alloc="one",arm="a1",H0=T)
df_res[i+1,]=c(rt=e2_t1e,r1=N1/N,r2=N2/N,
mu0=mean_control,mu1=mean_control,mu2=mean_control,
N=N,alloc="one",arm="a2",H0=T)
i=i+2
##########################################
# optimal allocation
y_opt = rdply(nsim,
do.call(rbind.data.frame,
models_cc(data = sim_designs(r1=N1/N,r2=N2/N,
mu0=mean_control,mu1=mean_control,mu2=mean_control,
N=N,alloc="opt")$data
)
)
)
# t1e / power
y1_t1e <- y_opt %>%
filter(arm == "a1") %>%
select(reject_h0)
e1_t1e <- sum(y1_t1e)/nsim
y2_t1e <- y_opt %>%
filter(arm == "a2") %>%
select(reject_h0)
e2_t1e <- sum(y2_t1e)/nsim
df_res[i,]=c(rt=e1_t1e,r1=N1/N,r2=N2/N,
mu0=mean_control,mu1=7,mu2=7,
N=N,alloc="opt",arm="a1",H0=T)
df_res[i+1,]=c(rt=e2_t1e,r1=N1/N,r2=N2/N,
mu0=mean_control,mu1=7,mu2=7,
N=N,alloc="opt",arm="a2",H0=T)
i=i+2
##########################################
# sqrt k allocation
y_sqrt = rdply(nsim,
do.call(rbind.data.frame,
models_cc(data = sim_designs(r1=N1/N,r2=N2/N,
mu0=mean_control,mu1=mean_control,mu2=mean_control,
N=N,alloc="sqrt")$data
)
)
)
# t1e / power
y1_t1e <- y_sqrt %>%
filter(arm == "a1") %>%
select(reject_h0)
e1_t1e <- sum(y1_t1e)/nsim
y2_t1e <- y_sqrt %>%
filter(arm == "a2") %>%
select(reject_h0)
e2_t1e <- sum(y2_t1e)/nsim
df_res[i,]=c(rt=e1_t1e,r1=N1/N,r2=N2/N,
mu0=mean_control,mu1=mean_control,mu2=mean_control,
N=N,alloc="sqrt",arm="a1",H0=T)
df_res[i+1,]=c(rt=e2_t1e,r1=N1/N,r2=N2/N,
mu0=mean_control,mu1=mean_control,mu2=mean_control,
N=N,alloc="sqrt",arm="a2",H0=T)
list_res_H0 = list(y,y_opt,y_sqrt)
df_res
i
load("C:/Users/mbofi/Dropbox/CeMSIIS/GitHub/Allocation/case-study/simstudy_results.RData")
load("C:/Users/mbofi/Dropbox/CeMSIIS/GitHub/Allocation/case-study/simstudy_results_part1.RData")
head(df_res)
View(df_res)
df_res
load("C:/Users/mbofi/Dropbox/CeMSIIS/GitHub/Allocation/case-study/simstudy_results.R.RData")
load("C:/Users/mbofi/Dropbox/CeMSIIS/GitHub/Allocation/case-study/results/simstudy_results.R.RData")
load("C:/Users/mbofi/Dropbox/CeMSIIS/GitHub/Allocation/case-study/results/simstudy_results.RData")
load("C:/Users/mbofi/Dropbox/CeMSIIS/GitHub/Allocation/case-study/results/simstudy_results.RData")
View(df_res)
df_res$design = ifelse(df_res$r1+df_res$r2==1,"2-period", "3-period")
df_res$r1+df_res$r2==1
(df_res$r1+df_res$r2==1)
(df_res$r1)
(df_res$r1==1-df_res$r2)
(df_res$r1=1-df_res$r2)
1==2
df_res$r1+df_res$r2
df_res
df_res$r1+df_res$r2
df_res$r2
is.numeric(df_res$r2)
as.numeric(df_res$r2)
df_res$design = ifelse(as.numeric(df_res$r1)+as.numeric(df_res$r2)==1,"2-period", "3-period")
df_res
knitr::kable(df_res, format = "markdown", caption = c("Sample sizes per period and arm (1:1)"))
res_report <- df_res %>% select(rt_a1,rt_a2,r1,r2,alloc,H0,minrt,design)
library(tidy)
library(tidyverse)
load("C:/Users/mbofi/Dropbox/CeMSIIS/GitHub/Allocation/case-study/results/simstudy_results.RData")
df_res$design = ifelse(as.numeric(df_res$r1)+as.numeric(df_res$r2)==1,"2-period", "3-period")
df_res$r1+df_res$r2
res_report <- df_res %>% select(rt_a1,rt_a2,r1,r2,alloc,H0,minrt,design)
res_report <- df_res %>% select(rt_a1,rt_a2,r1,r2,alloc,H0,minrt,design)
knitr::kable(res_report, format = "markdown", caption = c("Sample sizes per period and arm (1:1)"))
res_report_H0 <- df_res %>% select(rt_a1,rt_a2,r1,r2,alloc,H0,minrt,design) %>% filter(H0=="FALSE")
knitr::kable(res_report, format = "markdown", caption = c("Power comparisons"))
res_report_H0 <- df_res %>% select(rt_a1,rt_a2,r1,r2,alloc,H0,minrt,design) %>% filter(H0=="FALSE")
knitr::kable(res_report_H0, format = "markdown", caption = c("Power comparisons"))
res_report_H1 <- df_res %>% select(rt_a1,rt_a2,r1,r2,alloc,H0,minrt,design) %>% filter(H0=="TRUE")
knitr::kable(res_report_H1, format = "markdown", caption = c("Power comparisons"))
res_report_H1 <- df_res %>% select(rt_a1,rt_a2,r1,r2,alloc,minrt,design) %>% filter(H0=="FALSE")
library(tidyverse)
load("C:/Users/mbofi/Dropbox/CeMSIIS/GitHub/Allocation/case-study/results/simstudy_results.RData")
df_res$design = ifelse(as.numeric(df_res$r1)+as.numeric(df_res$r2)==1,"2-period", "3-period")
# df_res$r1+df_res$r2
res_report_H1 <- df_res %>% filter(H0=="FALSE") %>% select(rt_a1,rt_a2,r1,r2,alloc,minrt,design)
knitr::kable(res_report_H1, format = "markdown", caption = c("Power comparisons"))
res_report_H0 <- df_res %>% filter(H0=="TRUE") %>% select(rt_a1,rt_a2,r1,r2,alloc,minrt,design)
knitr::kable(res_report_H0, format = "markdown", caption = c("Type 1 error rate"))
rm(list = ls())
load("C:/Users/mbofi/Dropbox/CeMSIIS/GitHub/Allocation/case-study/results/simstudy_results.RData")
rm(list_res_H0)
rm(list_res_H0, list_res_H1, list_restwop_H0, list_restwop_H1,
db2_one,
db2_opt,
db2_sqrt,
db2_one_ss,
db2_opt_ss,
db2_sqrt_ss,
db3_one,
db3_opt,
db3_sqrt,
db3_one_ss,
db3_opt_ss,
db3_sqrt_ss)
rm(list_res_H0, list_res_H1, list_restwop_H0, list_restwop_H1,
db2_one,
db2_opt,
db2_sqrt,
db2_one_ss,
db2_opt_ss,
db2_sqrt_ss,
db3_one,
db3_opt,
db3_sqrt,
db3_one_ss,
db3_opt_ss,
db3_sqrt_ss,
y, y_opt, y_sqrt)
rm(list_res_H0, list_res_H1, list_restwop_H0, list_restwop_H1,
db2_one,
db2_opt,
db2_sqrt,
db2_one_ss,
db2_opt_ss,
db2_sqrt_ss,
db3_one,
db3_opt,
db3_sqrt,
db3_one_ss,
db3_opt_ss,
db3_sqrt_ss,
y, y_opt, y_sqrt
y1_t1e, y2_t1e)
rm(list_res_H0, list_res_H1, list_restwop_H0, list_restwop_H1,
db2_one,
db2_opt,
db2_sqrt,
db2_one_ss,
db2_opt_ss,
db2_sqrt_ss,
db3_one,
db3_opt,
db3_sqrt,
db3_one_ss,
db3_opt_ss,
db3_sqrt_ss,
y, y_opt, y_sqrt
y1_t1e, y2_t1e)
rm(list_res_H0, list_res_H1, list_restwop_H0, list_restwop_H1,
db2_one,
db2_opt,
db2_sqrt,
db2_one_ss,
db2_opt_ss,
db2_sqrt_ss,
db3_one,
db3_opt,
db3_sqrt,
db3_one_ss,
db3_opt_ss,
db3_sqrt_ss,
y, y_opt, y_sqrt,
y1_t1e, y2_t1e)
rm(list_res_H0, list_res_H1, list_restwop_H0, list_restwop_H1,
db2_one,
db2_opt,
db2_sqrt,
db2_one_ss,
db2_opt_ss,
db2_sqrt_ss,
db3_one,
db3_opt,
db3_sqrt,
db3_one_ss,
db3_opt_ss,
db3_sqrt_ss,
y, y_opt, y_sqrt,
y1_t1e, y2_t1e,
e1_t1e, e2_t1e)
rm(list_res_H0, list_res_H1, list_restwop_H0, list_restwop_H1,
db2_one,
db2_opt,
db2_sqrt,
db2_one_ss,
db2_opt_ss,
db2_sqrt_ss,
db3_one,
db3_opt,
db3_sqrt,
db3_one_ss,
db3_opt_ss,
db3_sqrt_ss,
y, y_opt, y_sqrt,
y1_t1e, y2_t1e,
e1_t1e, e2_t1e, i, mean_arm1, mean_arm2, mean_control, N, N1, N2, nsim)
##########################################
rm(list_res_H0, list_res_H1, list_restwop_H0, list_restwop_H1,
db2_one,
db2_opt,
db2_sqrt,
db2_one_ss,
db2_opt_ss,
db2_sqrt_ss,
db3_one,
db3_opt,
db3_sqrt,
db3_one_ss,
db3_opt_ss,
db3_sqrt_ss,
y, y_opt, y_sqrt,
y1_t1e, y2_t1e,
e1_t1e, e2_t1e, i, mean_arm1, mean_arm2, mean_control, N, N1, N2, nsim)
##########################################
# save.image("C:/Users/mbofi/Dropbox/CeMSIIS/GitHub/Allocation/case-study/simstudy_results.R.RData") #local
save.image("~/GitHub/Allocation/case-study/results/simstudy_results.RData") #server
##########################################
# save.image("C:/Users/mbofi/Dropbox/CeMSIIS/GitHub/Allocation/case-study/simstudy_results.R.RData") #local
save.image("~/GitHub/Allocation/case-study/simstudy_results.RData") #server
save.image("C:/Users/mbofi/Dropbox/CeMSIIS/GitHub/Allocation/case-study/results/simstudy_results.RData")
rm(list = ls())
load("C:/Users/mbofi/Dropbox/CeMSIIS/GitHub/Allocation/case-study/simstudy_results.RData")
list_res_H0
rm(db2_one,
db2_opt,
db2_sqrt,
db2_one_ss,
db2_opt_ss,
db2_sqrt_ss,
db3_one,
db3_opt,
db3_sqrt,
db3_one_ss,
db3_opt_ss,
db3_sqrt_ss,
y, y_opt, y_sqrt,
y1_t1e, y2_t1e,
e1_t1e, e2_t1e, i, mean_arm1, mean_arm2, mean_control, N, N1, N2, nsim)
save.image("C:/Users/mbofi/Dropbox/CeMSIIS/GitHub/Allocation/case-study/simstudy_results2.RData")
save.image("C:/Users/mbofi/Dropbox/CeMSIIS/GitHub/Allocation/case-study/simstudy_results.RData")
Power=function(x,y)x^y
cond_eq <- function(r22,r12,r1,r2){
r1/4 + r12 + Power(r12,2)/(-r2 + r22) + r22*(-1 - r22/(r12 - r2)) - (1-r1-r2)/4
}
inv_var <- function(r1,r2,r12){
r3 <- 1 - r1 - r2
r11 <- r01 <- r1/2
r23 <- r03 <- r3/2
r22 <- uniroot(cond_eq,c(0,r2),r12=r12,r1=r1,r2=r2)$root
r02 <- -r12 + r2 - r22
sol=c(r1,r2,r02,r12,r22)
return(sol)
}
Power=function(x,y)x^y
eq=function(r22,r1=0.1,r2=0.8) (r1 + ((Power(r2,2) - 4*r2*r22 + 2*Power(r22,2))*Power(Power(r2,2) - 2*r2*r22 + 2*Power(r22,2),2))/(Power(r2,2)*Power(r2 - r22,3)) - (1-r1-r2))/4.
fr12=function(r22,r1=0.1,r2=0.8) (r2*(r2 - 2*r22))/(2*(r2 - r22))
f=Vectorize(function(r1,r2) {
r22=uniroot(eq,c(0,r2),r1=r1,r2=r2)$root
r12=fr12(r22,r1,r2)
r02=r2-r12-r22
sol=c(r1,r2,r02,r12,r22)
sol
})
# f(r1=20/70,r2=30/70)
f(r1=20/70,r2=30/70)
x<-f(r1=20/70,r2=30/70)
x[4,]
inv_var(r1=20/70,r2=30/70,r12=x[4,])
r1=20/70;r2=30/70;r12=x[4,]
r3 <- 1 - r1 - r2
r11 <- r01 <- r1/2
r23 <- r03 <- r3/2
r22 <- uniroot(cond_eq,c(0,r2),r12=r12,r1=r1,r2=r2)$root
uniroot(cond_eq,c(0,r2),r12=r12,r1=r1,r2=r2)$root
cond_eq(c(0,r2),r12=r12,r1=r1,r2=r2))
cond_eq(c(0,r2),r12=r12,r1=r1,r2=r2)
r2
cond_eq(c(0,0.4),r12=r12,r1=r1,r2=r2)
uniroot(cond_eq,c(0,0.4),r12=r12,r1=r1,r2=r2)$root
uniroot(cond_eq,c(0,0.41),r12=r12,r1=r1,r2=r2)$root
inv_var <- function(r1,r2,r12,eps=0.0001){
r3 <- 1 - r1 - r2
r11 <- r01 <- r1/2
r23 <- r03 <- r3/2
r22 <- uniroot(cond_eq,c(0,r2-eps),r12=r12,r1=r1,r2=r2)$root
r02 <- -r12 + r2 - r22
sol=c(r1,r2,r02,r12,r22)
return(sol)
}
inv_var(r1=20/70,r2=30/70,r12=x[4,])
x
inv_var <- function(r1,r2,r12,eps=0.0001){
r3 <- 1 - r1 - r2
r11 <- r01 <- r1/2
r23 <- r03 <- r3/2
r22 <- uniroot(cond_eq,c(0,r2-eps),r12=r12,r1=r1,r2=r2)$root
r02 <- -r12 + r2 - r22
sol=c(r1,r2,r02,r12,r22)
term1 <- r1/4 + r12 + Power(r12,2)/(-r2 + r22)
return(list(inv_var=term1, solr=sol))
}
inv_var(r1=20/70,r2=30/70,r12=x[4,])
r1=20/70;r2=30/70;r12=x[4,]
(r1=20/70;r2=30/70;r12=x[4,] )
c(r1=20/70,r2=30/70,r12=x[4,] )
seq(0,1,0.1)
seq(x[4,],r2,0.1)
inv_var(r1=20/70,r2=30/70,r12=seq(x[4,],r2,0.1))
inv_var <- function(r12,r1,r2,eps=0.0001){
r3 <- 1 - r1 - r2
r11 <- r01 <- r1/2
r23 <- r03 <- r3/2
r22 <- uniroot(cond_eq,c(0,r2-eps),r12=r12,r1=r1,r2=r2)$root
r02 <- -r12 + r2 - r22
sol=c(r1,r2,r02,r12,r22)
term1 <- r1/4 + r12 + Power(r12,2)/(-r2 + r22)
return(list(inv_var=term1, solr=sol))
}
inv_var(r12=x[4,],r1=20/70,r2=30/70)
c(r12=x[4,],r1=20/70,r2=30/70)
seq(x[4,],r2,0.1)
seq(x[4,],r2,0.1)
inv_var(r12=seq(x[4,],r2,0.1),r1=20/70,r2=30/70)
apply(seq(x[4,],r2,0.1), inv_var, r1=20/70,r2=30/70)
apply(r12,seq(x[4,],r2,0.1), inv_var, r1=20/70,r2=30/70)
lapply(seq(x[4,],r2,0.1), inv_var, r1=20/70,r2=30/70)
lapply(seq(0,x[4,],0.1), inv_var, r1=20/70,r2=30/70)
lapply(seq(x[4,],r2,0.1), inv_var, r1=20/70,r2=30/70)
lapply(seq(0.1,x[4,],0.1), inv_var, r1=20/70,r2=30/70)
inv_var <- function(r12,r1,r2,eps=0.0001){
r3 <- 1 - r1 - r2
r11 <- r01 <- r1/2
r23 <- r03 <- r3/2
r22 <- uniroot(cond_eq,c(0,r2-eps),r12=r12,r1=r1,r2=r2)$root
r02 <- -r12 + r2 - r22
sol=c(r1,r2,r02,r12,r22)
term1 <- r1/4 + r12 + Power(r12,2)/(-r2 + r22)
return(list(inv_var=1/term1, solr=sol))
}
inv_var(r12=x[4,],r1=20/70,r2=30/70)
c(r12=x[4,],r1=20/70,r2=30/70)
seq(x[4,],r2,0.1)
seq(x[4,],r2,0.1)
inv_var(r12=seq(x[4,],r2,0.1),r1=20/70,r2=30/70)
inv_var <- function(r12,r1,r2,eps=0.0001){
r3 <- 1 - r1 - r2
r11 <- r01 <- r1/2
r23 <- r03 <- r3/2
r22 <- uniroot(cond_eq,c(0,r2-eps),r12=r12,r1=r1,r2=r2)$root
r02 <- -r12 + r2 - r22
sol=c(r1,r2,r02,r12,r22)
term1 <- r1/4 + r12 + Power(r12,2)/(-r2 + r22)
return(list(inv_var=term1, solr=sol))
}
inv_var(r12=x[4,],r1=20/70,r2=30/70)
c(r12=x[4,],r1=20/70,r2=30/70)
seq(x[4,],r2,0.1)
seq(x[4,],r2,0.1)
inv_var(r12=seq(x[4,],r2,0.1),r1=20/70,r2=30/70)
inv_var <- function(r12,r1,r2,eps=0.0001){
r3 <- 1 - r1 - r2
r11 <- r01 <- r1/2
r23 <- r03 <- r3/2
r22 <- uniroot(cond_eq,c(0,r2-eps),r12=r12,r1=r1,r2=r2)$root
r02 <- -r12 + r2 - r22
sol=c(r1,r2,r02,r12,r22)
term1 <- r1/4 + r12 + Power(r12,2)/(-r2 + r22)
return(list(inv_var=1/term1, solr=sol))
}
inv_var(r12=x[4,],r1=20/70,r2=30/70)
c(r12=x[4,],r1=20/70,r2=30/70)
seq(x[4,],r2,0.1)
seq(x[4,],r2,0.1)
lapply(seq(0.1,x[4,],0.1), inv_var, r1=20/70,r2=30/70)
seq(0.1,x[4,],0.1)
x[4,]
lapply(seq(x[4,],r2,0.1), inv_var, r1=20/70,r2=30/70)
inv_var <- function(r12,r1,r2,eps=0.0001){
r3 <- 1 - r1 - r2
r11 <- r01 <- r1/2
r23 <- r03 <- r3/2
r22 <- uniroot(cond_eq,c(0,r2-eps),r12=r12,r1=r1,r2=r2)$root
r02 <- -r12 + r2 - r22
term1 <- r1/4 + r12 + Power(r12,2)/(-r2 + r22)
return(c(r1=r1,r2=r2,r02=r02,r12=r12,r22=r22,inv_var=1/term1))
}
inv_var(r12=x[4,],r1=20/70,r2=30/70)
lapply(seq(x[4,],r2,0.1), inv_var, r1=20/70,r2=30/70)
inv_var <- function(r12,r1,r2,eps=0.0001){
r3 <- 1 - r1 - r2
r11 <- r01 <- r1/2
r23 <- r03 <- r3/2
r22 <- uniroot(cond_eq,c(0,r2-eps),r12=r12,r1=r1,r2=r2)$root
r02 <- -r12 + r2 - r22
term1 <- r1/4 + r12 + Power(r12,2)/(-r2 + r22)
return(c(r1,r2,r02,r12,r22,1/term1))
# return(c(r1=r1,r2=r2,r02=r02,r12=r12,r22=r22,inv_var=1/term1))
}
inv_var(r12=x[4,],r1=20/70,r2=30/70)
lapply(seq(x[4,],r2,0.1), inv_var, r1=20/70,r2=30/70)
res <- lapply(seq(x[4,],r2,0.1), inv_var, r1=20/70,r2=30/70)
is.list(res)
unlist(res)
matrix(unlist(res),row=6)
matrix(unlist(res),nrow=6)
res <- lapply(seq(x[4,],r2,0.1), inv_var, r1=20/70,r2=30/70)
res
matrix(unlist(res),nrow=6)
matrix(unlist(res),nrow=6, byrow = T)
res <- lapply(seq(x[4,],r2,0.1), inv_var, r1=20/70,r2=30/70)
res
matrix(unlist(res),nrow=6, byrow = T)
matrix(unlist(res),ncol=6, byrow = T)
x[4,]
res <- lapply(seq(0,r2,0.01), inv_var, r1=20/70,r2=30/70)
res <- lapply(seq(0.01,r2,0.01), inv_var, r1=20/70,r2=30/70)
is.list(res)
unlist(res)
matrix(unlist(res),ncol=6, byrow = T)
matrix_data <- matrix(unlist(res),ncol=6, byrow = T)
as.data.frame(matrix_data)
library(tidyverse)
data_res %>%
rename(
r1=V1
)
data_res <- as.data.frame(matrix_res)
matrix_res <- matrix(unlist(res),ncol=6, byrow = T)
data_res <- as.data.frame(matrix_res)
data_res %>%
rename(
r1=V1
)
data_res %>%
rename(
r1 = V1,
r2 = V2,
r02 = V3,
r12 = V4,
r22 = V5,
var = V6
)
data_res %>%
rename(
r1 = V1,
r2 = V2,
r02 = V3,
r12 = V4,
r22 = V5,
var = V6
)
head(data_res)
