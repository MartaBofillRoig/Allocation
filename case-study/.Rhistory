# setwd("~/GitHub/Allocation/case-study")
library(tidyverse)
library(dplyr)
# install.packages("plyr")
library(plyr)
# devtools::install_github("pavlakrotka/NCC@v1.1", force=T)
library(NCC)
# devtools::install_github("ianmoran11/mmtable2")
library(mmtable2)
# install.packages("gt")
library(gt)
##########################################
# Functions
source("C:/Users/mbofi/Dropbox/CeMSIIS/GitHub/Allocation/case-study/aux_functions.R") #local
# source("~/GitHub/Allocation/case-study/aux_functions.R") #server
##########################################
# Case study
##########################################
# original study - obtained means
mean_control = 17.3/3.5
mean_arm1 = 66.2/3.5
mean_arm2 = 72.3/3.5
##########################################
# design 3: three-period design (symmetric design)
##########################################
N = 92
N1 = N
N3 = 0
N2 = N-N1-N3
c(N1,N2,N-N1-N2)
alloc_str <- c("one","opt","sqrt")
for(i in 1:3){
m <- sim_designs(r1=N1/N,r2=N2/N,
mu0=mean_control,mu1=6,mu2=6,
N=N,alloc=alloc_str[i],sl=0)$ss
rownames(m) <- c("Arm 2", "Arm 1", "Control")
print(knitr::kable(m,
format = "latex", caption = paste(alloc_str[i]),
col.names = c("Period 1", "Period 2", "Period 3"),
row.names=T,
digits=3))
}
rm(list = ls())
library(tidyverse)
rm(list = ls())
library(tidyverse)
load("C:/Users/mbofi/Dropbox/CeMSIIS/GitHub/Allocation/case-study/results/simstudy_completeresults_withvar_nov_pwadj_timetrends.RData")
# load("C:/Users/mbofi/Dropbox/CeMSIIS/GitHub/Allocation/case-study/results/simstudy_completeresults_withvar_nov.RData")
df_res<-df_res %>%
mutate(design = case_when(
as.numeric(df_res$r1)==1 ~ "1-period",
as.numeric(df_res$r1)+as.numeric(df_res$r2)==1 & as.numeric(df_res$r2)>0 ~ "2-period",
as.numeric(df_res$r1)+as.numeric(df_res$r2)<1 ~ "3-period"
))
df_res$r1 <- as.numeric(df_res$r1)
df_res$r2 <- as.numeric(df_res$r2)
df_res$rt_a1 <- as.numeric(df_res$rt_a1)
df_res$rt_a2 <- as.numeric(df_res$rt_a2)
df_res$var_e1 <- as.numeric(df_res$var_e1)
df_res$var_e2 <- as.numeric(df_res$var_e2)
# summary tables
res_report_H1 <- df_res %>% filter(H0=="FALSE") %>% select(rt_a1,rt_a2,var_e1,var_e2,r1,r2,alloc,minrt,design)
knitr::kable(res_report_H1, format = "markdown", caption = c("Power comparisons"), digits=3)
res_report_H0 <- df_res %>% filter(H0=="TRUE") %>% select(rt_a1,rt_a2,var_e1,var_e2,r1,r2,alloc,minrt,design)
knitr::kable(res_report_H0, format = "markdown", caption = c("Type 1 error rate"), digits=3)
res_report_H1$width_ci_a1 <- c(rep(NA,dim(res_report_H1)[1]))
res_report_H1$width_ci_a2 <- c(rep(NA,dim(res_report_H1)[1]))
res_report_H0$width_ci_a1 <- c(rep(NA,dim(res_report_H0)[1]))
res_report_H0$width_ci_a2 <- c(rep(NA,dim(res_report_H0)[1]))
##########################################
# 3-periods symmetric
##########################################
# list_res_H1 = list(y,y_opt,y_sqrt)
# one to one allocation
# H1
width_ci_a1 <- list_res_sym_H1[[1]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a1$width <- width_ci_a1$upper_ci - width_ci_a1$lower_ci
res_report_H1$width_ci_a1[1] <- mean(width_ci_a1$width)
width_ci_a2 <- list_res_sym_H1[[1]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a2$width <- width_ci_a2$upper_ci - width_ci_a2$lower_ci
res_report_H1$width_ci_a2[1] <- mean(width_ci_a2$width)
# boxplot(width_ci_a1$width-width_ci_a2$width)
# H0
width_ci_a1 <- list_res_sym_H0[[1]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a1$width <- width_ci_a1$upper_ci - width_ci_a1$lower_ci
res_report_H0$width_ci_a1[1] <-mean(width_ci_a1$width)
width_ci_a2 <- list_res_sym_H0[[1]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a2$width <- width_ci_a2$upper_ci - width_ci_a2$lower_ci
res_report_H0$width_ci_a2[1] <-mean(width_ci_a2$width)
# opt allocation
# H1
width_ciopt_a1 <- list_res_sym_H1[[2]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a1$width <- width_ciopt_a1$upper_ci - width_ciopt_a1$lower_ci
res_report_H1$width_ci_a1[2] <- mean(width_ciopt_a1$width)
width_ciopt_a2 <- list_res_sym_H1[[2]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a2$width <- width_ciopt_a2$upper_ci - width_ciopt_a2$lower_ci
res_report_H1$width_ci_a2[2] <- mean(width_ciopt_a2$width)
# boxplot(width_ciopt_a1$width-width_ciopt_a2$width)
# H0
width_ciopt_a1 <- list_res_sym_H0[[2]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a1$width <- width_ciopt_a1$upper_ci - width_ciopt_a1$lower_ci
res_report_H0$width_ci_a1[2] <- mean(width_ciopt_a1$width)
width_ciopt_a2 <- list_res_sym_H0[[2]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a2$width <- width_ciopt_a2$upper_ci - width_ciopt_a2$lower_ci
res_report_H0$width_ci_a2[2] <- mean(width_ciopt_a2$width)
# sqrt allocation
# H1
width_cisqrt_a1 <- list_res_sym_H1[[3]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a1$width <- width_cisqrt_a1$upper_ci - width_cisqrt_a1$lower_ci
res_report_H1$width_ci_a1[3] <- mean(width_cisqrt_a1$width)
width_cisqrt_a2 <- list_res_sym_H1[[3]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a2$width <- width_cisqrt_a2$upper_ci - width_cisqrt_a2$lower_ci
res_report_H1$width_ci_a2[3] <- mean(width_cisqrt_a2$width)
# H0
width_cisqrt_a1 <- list_res_sym_H0[[3]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a1$width <- width_cisqrt_a1$upper_ci - width_cisqrt_a1$lower_ci
res_report_H0$width_ci_a1[3] <- mean(width_cisqrt_a1$width)
width_cisqrt_a2 <- list_res_sym_H0[[3]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a2$width <- width_cisqrt_a2$upper_ci - width_cisqrt_a2$lower_ci
res_report_H0$width_ci_a2[3] <- mean(width_cisqrt_a2$width)
##########################################
# 3-periods nonsymmetric
##########################################
# list_res_H1 = list(y,y_opt,y_sqrt)
# one to one allocation
# H1
width_ci_a1 <- list_res_nsym_H1[[1]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a1$width <- width_ci_a1$upper_ci - width_ci_a1$lower_ci
res_report_H1$width_ci_a1[4] <- mean(width_ci_a1$width)
width_ci_a2 <- list_res_nsym_H1[[1]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a2$width <- width_ci_a2$upper_ci - width_ci_a2$lower_ci
res_report_H1$width_ci_a2[4] <-mean(width_ci_a2$width)
# H0
width_ci_a1 <- list_res_nsym_H0[[1]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a1$width <- width_ci_a1$upper_ci - width_ci_a1$lower_ci
res_report_H0$width_ci_a1[4] <-mean(width_ci_a1$width)
width_ci_a2 <- list_res_nsym_H0[[1]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a2$width <- width_ci_a2$upper_ci - width_ci_a2$lower_ci
res_report_H0$width_ci_a2[4] <-mean(width_ci_a2$width)
# opt allocation
# H1
width_ciopt_a1 <- list_res_nsym_H1[[2]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a1$width <- width_ciopt_a1$upper_ci - width_ciopt_a1$lower_ci
res_report_H1$width_ci_a1[5] <- mean(width_ciopt_a1$width)
width_ciopt_a2 <- list_res_nsym_H1[[2]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a2$width <- width_ciopt_a2$upper_ci - width_ciopt_a2$lower_ci
res_report_H1$width_ci_a2[5] <- mean(width_ciopt_a2$width)
# boxplot(width_ciopt_a1$width-width_ciopt_a2$width)
# H0
width_ciopt_a1 <- list_res_nsym_H0[[2]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a1$width <- width_ciopt_a1$upper_ci - width_ciopt_a1$lower_ci
res_report_H0$width_ci_a1[5] <- mean(width_ciopt_a1$width)
width_ciopt_a2 <- list_res_nsym_H0[[2]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a2$width <- width_ciopt_a2$upper_ci - width_ciopt_a2$lower_ci
res_report_H0$width_ci_a2[5] <- mean(width_ciopt_a2$width)
# sqrt allocation
# H1
width_cisqrt_a1 <- list_res_nsym_H1[[3]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a1$width <- width_cisqrt_a1$upper_ci - width_cisqrt_a1$lower_ci
res_report_H1$width_ci_a1[6] <- mean(width_cisqrt_a1$width)
width_cisqrt_a2 <- list_res_nsym_H1[[3]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a2$width <- width_cisqrt_a2$upper_ci - width_cisqrt_a2$lower_ci
res_report_H1$width_ci_a2[6] <- mean(width_cisqrt_a2$width)
# H0
width_cisqrt_a1 <- list_res_nsym_H0[[3]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a1$width <- width_cisqrt_a1$upper_ci - width_cisqrt_a1$lower_ci
res_report_H0$width_ci_a1[6] <- mean(width_cisqrt_a1$width)
width_cisqrt_a2 <- list_res_nsym_H0[[3]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a2$width <- width_cisqrt_a2$upper_ci - width_cisqrt_a2$lower_ci
res_report_H0$width_ci_a2[6] <- mean(width_cisqrt_a2$width)
##########################################
# Two periods
##########################################
# list_restwop_H0
# list_restwop_H1
# one to one allocation
# H1
width_ci_a1 <- list_restwop_H1[[1]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a1$width <- width_ci_a1$upper_ci - width_ci_a1$lower_ci
res_report_H1$width_ci_a1[7] <- mean(width_ci_a1$width)
width_ci_a2 <- list_restwop_H1[[1]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a2$width <- width_ci_a2$upper_ci - width_ci_a2$lower_ci
res_report_H1$width_ci_a2[7] <- mean(width_ci_a2$width)
# H0
width_ci_a1 <- list_restwop_H0[[1]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a1$width <- width_ci_a1$upper_ci - width_ci_a1$lower_ci
res_report_H0$width_ci_a1[7] <-mean(width_ci_a1$width)
width_ci_a2 <- list_restwop_H0[[1]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a2$width <- width_ci_a2$upper_ci - width_ci_a2$lower_ci
res_report_H0$width_ci_a2[7] <-mean(width_ci_a2$width)
# opt allocation
# H1
width_ciopt_a1 <- list_restwop_H1[[2]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a1$width <- width_ciopt_a1$upper_ci - width_ciopt_a1$lower_ci
res_report_H1$width_ci_a1[8] <- mean(width_ciopt_a1$width)
width_ciopt_a2 <- list_restwop_H1[[2]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a2$width <- width_ciopt_a2$upper_ci - width_ciopt_a2$lower_ci
res_report_H1$width_ci_a2[8] <- mean(width_ciopt_a2$width)
# H0
width_ciopt_a1 <- list_restwop_H0[[2]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a1$width <- width_ciopt_a1$upper_ci - width_ciopt_a1$lower_ci
res_report_H0$width_ci_a1[8] <- mean(width_ciopt_a1$width)
width_ciopt_a2 <- list_restwop_H0[[2]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a2$width <- width_ciopt_a2$upper_ci - width_ciopt_a2$lower_ci
res_report_H0$width_ci_a2[8] <- mean(width_ciopt_a2$width)
# sqrt allocation
# H1
width_cisqrt_a1 <- list_restwop_H1[[3]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a1$width <- width_cisqrt_a1$upper_ci - width_cisqrt_a1$lower_ci
res_report_H1$width_ci_a1[9] <- mean(width_cisqrt_a1$width)
width_cisqrt_a2 <- list_restwop_H1[[3]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a2$width <- width_cisqrt_a2$upper_ci - width_cisqrt_a2$lower_ci
res_report_H1$width_ci_a2[9] <- mean(width_cisqrt_a2$width)
# H0
width_cisqrt_a1 <- list_restwop_H0[[3]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a1$width <- width_cisqrt_a1$upper_ci - width_cisqrt_a1$lower_ci
res_report_H0$width_ci_a1[9] <- mean(width_cisqrt_a1$width)
width_cisqrt_a2 <- list_restwop_H0[[3]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a2$width <- width_cisqrt_a2$upper_ci - width_cisqrt_a2$lower_ci
res_report_H0$width_ci_a2[9] <- mean(width_cisqrt_a2$width)
##########################################
# 1-periods
##########################################
# one to one allocation
# H1
width_ci_a1 <- list_res_mams_H1[[1]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a1$width <- width_ci_a1$upper_ci - width_ci_a1$lower_ci
res_report_H1$width_ci_a1[10] <- mean(width_ci_a1$width)
width_ci_a2 <- list_res_mams_H1[[1]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a2$width <- width_ci_a2$upper_ci - width_ci_a2$lower_ci
res_report_H1$width_ci_a2[10] <- mean(width_ci_a2$width)
# boxplot(width_ci_a1$width-width_ci_a2$width)
# H0
width_ci_a1 <- list_res_mams_H0[[1]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a1$width <- width_ci_a1$upper_ci - width_ci_a1$lower_ci
res_report_H0$width_ci_a1[10] <-mean(width_ci_a1$width)
width_ci_a2 <- list_res_mams_H0[[1]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a2$width <- width_ci_a2$upper_ci - width_ci_a2$lower_ci
res_report_H0$width_ci_a2[10] <-mean(width_ci_a2$width)
# opt allocation
# H1
width_ciopt_a1 <- list_res_mams_H1[[2]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a1$width <- width_ciopt_a1$upper_ci - width_ciopt_a1$lower_ci
res_report_H1$width_ci_a1[11] <- mean(width_ciopt_a1$width)
width_ciopt_a2 <- list_res_mams_H1[[2]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a2$width <- width_ciopt_a2$upper_ci - width_ciopt_a2$lower_ci
res_report_H1$width_ci_a2[11] <- mean(width_ciopt_a2$width)
# boxplot(width_ciopt_a1$width-width_ciopt_a2$width)
# H0
width_ciopt_a1 <- list_res_mams_H0[[2]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a1$width <- width_ciopt_a1$upper_ci - width_ciopt_a1$lower_ci
res_report_H0$width_ci_a1[11] <- mean(width_ciopt_a1$width)
width_ciopt_a2 <- list_res_mams_H0[[2]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a2$width <- width_ciopt_a2$upper_ci - width_ciopt_a2$lower_ci
res_report_H0$width_ci_a2[11] <- mean(width_ciopt_a2$width)
# sqrt allocation
# H1
width_cisqrt_a1 <- list_res_mams_H1[[3]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a1$width <- width_cisqrt_a1$upper_ci - width_cisqrt_a1$lower_ci
res_report_H1$width_ci_a1[12] <- mean(width_cisqrt_a1$width)
width_cisqrt_a2 <- list_res_mams_H1[[3]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a2$width <- width_cisqrt_a2$upper_ci - width_cisqrt_a2$lower_ci
res_report_H1$width_ci_a2[12] <- mean(width_cisqrt_a2$width)
# H0
width_cisqrt_a1 <- list_res_mams_H0[[3]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a1$width <- width_cisqrt_a1$upper_ci - width_cisqrt_a1$lower_ci
res_report_H0$width_ci_a1[12] <- mean(width_cisqrt_a1$width)
width_cisqrt_a2 <- list_res_mams_H0[[3]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a2$width <- width_cisqrt_a2$upper_ci - width_cisqrt_a2$lower_ci
res_report_H0$width_ci_a2[12] <- mean(width_cisqrt_a2$width)
##########################################
# summary tables
# res_report_H1table <- df_res %>% filter(H0=="FALSE") #%>% select(rt_a1,rt_a2,var_e1,var_e2,r1,r2,alloc,minrt,design)
table_H1 <- res_report_H1[c(9, 5:7, 1:2, 10:11, 3:4)]
knitr::kable(table_H1, format = "latex", caption = c("Power comparisons"), col.names = c("Design", "r1","r2", "Allocation", "Power A1","Power A2", "CI Width A1", "CI Width A2", "Variance A1", "Variance A2"), digits=3)
# res_report_H0table <- df_res %>% filter(H0=="TRUE") %>% select(rt_a1,rt_a2,var_e1,var_e2,r1,r2,alloc,minrt,design)
table_H0 <- res_report_H0[c(9, 5:7, 1:2, 10:11, 3:4)]
knitr::kable(table_H0, format = "latex", caption = c("Type 1 error rate comparisons"), col.names = c("Design",  "r1","r2", "Allocation", "T1E A1","T1E A2","CI Width A1", "CI Width A2", "Variance A1", "Variance A2"), digits=3)
rm(list = ls())
library(tidyverse)
load("C:/Users/mbofi/Dropbox/CeMSIIS/GitHub/Allocation/case-study/results/simstudy_completeresults_withvar_nov_pwadj_timetrends.RData")
# load("C:/Users/mbofi/Dropbox/CeMSIIS/GitHub/Allocation/case-study/results/simstudy_completeresults_withvar_nov.RData")
df_res<-df_res %>%
mutate(design = case_when(
as.numeric(df_res$r1)==1 ~ "1-period",
as.numeric(df_res$r1)+as.numeric(df_res$r2)==1 & as.numeric(df_res$r2)>0 ~ "2-period",
as.numeric(df_res$r1)+as.numeric(df_res$r2)<1 ~ "3-period"
))
df_res$r1 <- as.numeric(df_res$r1)
df_res$r2 <- as.numeric(df_res$r2)
df_res$rt_a1 <- as.numeric(df_res$rt_a1)
df_res$rt_a2 <- as.numeric(df_res$rt_a2)
df_res$var_e1 <- as.numeric(df_res$var_e1)
df_res$var_e2 <- as.numeric(df_res$var_e2)
# summary tables
res_report_H1 <- df_res %>% filter(H0=="FALSE") %>% select(rt_a1,rt_a2,var_e1,var_e2,r1,r2,alloc,minrt,design)
knitr::kable(res_report_H1, format = "markdown", caption = c("Power comparisons"), digits=3)
res_report_H0 <- df_res %>% filter(H0=="TRUE") %>% select(rt_a1,rt_a2,var_e1,var_e2,r1,r2,alloc,minrt,design)
knitr::kable(res_report_H0, format = "markdown", caption = c("Type 1 error rate"), digits=3)
res_report_H1$width_ci_a1 <- c(rep(NA,dim(res_report_H1)[1]))
res_report_H1$width_ci_a2 <- c(rep(NA,dim(res_report_H1)[1]))
res_report_H0$width_ci_a1 <- c(rep(NA,dim(res_report_H0)[1]))
res_report_H0$width_ci_a2 <- c(rep(NA,dim(res_report_H0)[1]))
##########################################
# 3-periods symmetric
##########################################
# list_res_H1 = list(y,y_opt,y_sqrt)
# one to one allocation
# H1
width_ci_a1 <- list_res_sym_H1[[1]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a1$width <- width_ci_a1$upper_ci - width_ci_a1$lower_ci
res_report_H1$width_ci_a1[1] <- mean(width_ci_a1$width)
width_ci_a2 <- list_res_sym_H1[[1]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a2$width <- width_ci_a2$upper_ci - width_ci_a2$lower_ci
res_report_H1$width_ci_a2[1] <- mean(width_ci_a2$width)
# boxplot(width_ci_a1$width-width_ci_a2$width)
# H0
width_ci_a1 <- list_res_sym_H0[[1]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a1$width <- width_ci_a1$upper_ci - width_ci_a1$lower_ci
res_report_H0$width_ci_a1[1] <-mean(width_ci_a1$width)
width_ci_a2 <- list_res_sym_H0[[1]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a2$width <- width_ci_a2$upper_ci - width_ci_a2$lower_ci
res_report_H0$width_ci_a2[1] <-mean(width_ci_a2$width)
# opt allocation
# H1
width_ciopt_a1 <- list_res_sym_H1[[2]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a1$width <- width_ciopt_a1$upper_ci - width_ciopt_a1$lower_ci
res_report_H1$width_ci_a1[2] <- mean(width_ciopt_a1$width)
width_ciopt_a2 <- list_res_sym_H1[[2]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a2$width <- width_ciopt_a2$upper_ci - width_ciopt_a2$lower_ci
res_report_H1$width_ci_a2[2] <- mean(width_ciopt_a2$width)
# boxplot(width_ciopt_a1$width-width_ciopt_a2$width)
# H0
width_ciopt_a1 <- list_res_sym_H0[[2]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a1$width <- width_ciopt_a1$upper_ci - width_ciopt_a1$lower_ci
res_report_H0$width_ci_a1[2] <- mean(width_ciopt_a1$width)
width_ciopt_a2 <- list_res_sym_H0[[2]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a2$width <- width_ciopt_a2$upper_ci - width_ciopt_a2$lower_ci
res_report_H0$width_ci_a2[2] <- mean(width_ciopt_a2$width)
# sqrt allocation
# H1
width_cisqrt_a1 <- list_res_sym_H1[[3]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a1$width <- width_cisqrt_a1$upper_ci - width_cisqrt_a1$lower_ci
res_report_H1$width_ci_a1[3] <- mean(width_cisqrt_a1$width)
width_cisqrt_a2 <- list_res_sym_H1[[3]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a2$width <- width_cisqrt_a2$upper_ci - width_cisqrt_a2$lower_ci
res_report_H1$width_ci_a2[3] <- mean(width_cisqrt_a2$width)
# H0
width_cisqrt_a1 <- list_res_sym_H0[[3]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a1$width <- width_cisqrt_a1$upper_ci - width_cisqrt_a1$lower_ci
res_report_H0$width_ci_a1[3] <- mean(width_cisqrt_a1$width)
width_cisqrt_a2 <- list_res_sym_H0[[3]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a2$width <- width_cisqrt_a2$upper_ci - width_cisqrt_a2$lower_ci
res_report_H0$width_ci_a2[3] <- mean(width_cisqrt_a2$width)
##########################################
# 3-periods nonsymmetric
##########################################
# list_res_H1 = list(y,y_opt,y_sqrt)
# one to one allocation
# H1
width_ci_a1 <- list_res_nsym_H1[[1]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a1$width <- width_ci_a1$upper_ci - width_ci_a1$lower_ci
res_report_H1$width_ci_a1[4] <- mean(width_ci_a1$width)
width_ci_a2 <- list_res_nsym_H1[[1]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a2$width <- width_ci_a2$upper_ci - width_ci_a2$lower_ci
res_report_H1$width_ci_a2[4] <-mean(width_ci_a2$width)
# H0
width_ci_a1 <- list_res_nsym_H0[[1]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a1$width <- width_ci_a1$upper_ci - width_ci_a1$lower_ci
res_report_H0$width_ci_a1[4] <-mean(width_ci_a1$width)
width_ci_a2 <- list_res_nsym_H0[[1]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a2$width <- width_ci_a2$upper_ci - width_ci_a2$lower_ci
res_report_H0$width_ci_a2[4] <-mean(width_ci_a2$width)
# opt allocation
# H1
width_ciopt_a1 <- list_res_nsym_H1[[2]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a1$width <- width_ciopt_a1$upper_ci - width_ciopt_a1$lower_ci
res_report_H1$width_ci_a1[5] <- mean(width_ciopt_a1$width)
width_ciopt_a2 <- list_res_nsym_H1[[2]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a2$width <- width_ciopt_a2$upper_ci - width_ciopt_a2$lower_ci
res_report_H1$width_ci_a2[5] <- mean(width_ciopt_a2$width)
# boxplot(width_ciopt_a1$width-width_ciopt_a2$width)
# H0
width_ciopt_a1 <- list_res_nsym_H0[[2]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a1$width <- width_ciopt_a1$upper_ci - width_ciopt_a1$lower_ci
res_report_H0$width_ci_a1[5] <- mean(width_ciopt_a1$width)
width_ciopt_a2 <- list_res_nsym_H0[[2]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a2$width <- width_ciopt_a2$upper_ci - width_ciopt_a2$lower_ci
res_report_H0$width_ci_a2[5] <- mean(width_ciopt_a2$width)
# sqrt allocation
# H1
width_cisqrt_a1 <- list_res_nsym_H1[[3]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a1$width <- width_cisqrt_a1$upper_ci - width_cisqrt_a1$lower_ci
res_report_H1$width_ci_a1[6] <- mean(width_cisqrt_a1$width)
width_cisqrt_a2 <- list_res_nsym_H1[[3]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a2$width <- width_cisqrt_a2$upper_ci - width_cisqrt_a2$lower_ci
res_report_H1$width_ci_a2[6] <- mean(width_cisqrt_a2$width)
# H0
width_cisqrt_a1 <- list_res_nsym_H0[[3]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a1$width <- width_cisqrt_a1$upper_ci - width_cisqrt_a1$lower_ci
res_report_H0$width_ci_a1[6] <- mean(width_cisqrt_a1$width)
width_cisqrt_a2 <- list_res_nsym_H0[[3]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a2$width <- width_cisqrt_a2$upper_ci - width_cisqrt_a2$lower_ci
res_report_H0$width_ci_a2[6] <- mean(width_cisqrt_a2$width)
##########################################
# Two periods
##########################################
# list_restwop_H0
# list_restwop_H1
# one to one allocation
# H1
width_ci_a1 <- list_restwop_H1[[1]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a1$width <- width_ci_a1$upper_ci - width_ci_a1$lower_ci
res_report_H1$width_ci_a1[7] <- mean(width_ci_a1$width)
width_ci_a2 <- list_restwop_H1[[1]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a2$width <- width_ci_a2$upper_ci - width_ci_a2$lower_ci
res_report_H1$width_ci_a2[7] <- mean(width_ci_a2$width)
# H0
width_ci_a1 <- list_restwop_H0[[1]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a1$width <- width_ci_a1$upper_ci - width_ci_a1$lower_ci
res_report_H0$width_ci_a1[7] <-mean(width_ci_a1$width)
width_ci_a2 <- list_restwop_H0[[1]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a2$width <- width_ci_a2$upper_ci - width_ci_a2$lower_ci
res_report_H0$width_ci_a2[7] <-mean(width_ci_a2$width)
# opt allocation
# H1
width_ciopt_a1 <- list_restwop_H1[[2]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a1$width <- width_ciopt_a1$upper_ci - width_ciopt_a1$lower_ci
res_report_H1$width_ci_a1[8] <- mean(width_ciopt_a1$width)
width_ciopt_a2 <- list_restwop_H1[[2]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a2$width <- width_ciopt_a2$upper_ci - width_ciopt_a2$lower_ci
res_report_H1$width_ci_a2[8] <- mean(width_ciopt_a2$width)
# H0
width_ciopt_a1 <- list_restwop_H0[[2]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a1$width <- width_ciopt_a1$upper_ci - width_ciopt_a1$lower_ci
res_report_H0$width_ci_a1[8] <- mean(width_ciopt_a1$width)
width_ciopt_a2 <- list_restwop_H0[[2]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a2$width <- width_ciopt_a2$upper_ci - width_ciopt_a2$lower_ci
res_report_H0$width_ci_a2[8] <- mean(width_ciopt_a2$width)
# sqrt allocation
# H1
width_cisqrt_a1 <- list_restwop_H1[[3]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a1$width <- width_cisqrt_a1$upper_ci - width_cisqrt_a1$lower_ci
res_report_H1$width_ci_a1[9] <- mean(width_cisqrt_a1$width)
width_cisqrt_a2 <- list_restwop_H1[[3]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a2$width <- width_cisqrt_a2$upper_ci - width_cisqrt_a2$lower_ci
res_report_H1$width_ci_a2[9] <- mean(width_cisqrt_a2$width)
# H0
width_cisqrt_a1 <- list_restwop_H0[[3]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a1$width <- width_cisqrt_a1$upper_ci - width_cisqrt_a1$lower_ci
res_report_H0$width_ci_a1[9] <- mean(width_cisqrt_a1$width)
width_cisqrt_a2 <- list_restwop_H0[[3]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a2$width <- width_cisqrt_a2$upper_ci - width_cisqrt_a2$lower_ci
res_report_H0$width_ci_a2[9] <- mean(width_cisqrt_a2$width)
##########################################
# 1-periods
##########################################
# one to one allocation
# H1
width_ci_a1 <- list_res_mams_H1[[1]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a1$width <- width_ci_a1$upper_ci - width_ci_a1$lower_ci
res_report_H1$width_ci_a1[10] <- mean(width_ci_a1$width)
width_ci_a2 <- list_res_mams_H1[[1]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a2$width <- width_ci_a2$upper_ci - width_ci_a2$lower_ci
res_report_H1$width_ci_a2[10] <- mean(width_ci_a2$width)
# boxplot(width_ci_a1$width-width_ci_a2$width)
# H0
width_ci_a1 <- list_res_mams_H0[[1]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a1$width <- width_ci_a1$upper_ci - width_ci_a1$lower_ci
res_report_H0$width_ci_a1[10] <-mean(width_ci_a1$width)
width_ci_a2 <- list_res_mams_H0[[1]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ci_a2$width <- width_ci_a2$upper_ci - width_ci_a2$lower_ci
res_report_H0$width_ci_a2[10] <-mean(width_ci_a2$width)
# opt allocation
# H1
width_ciopt_a1 <- list_res_mams_H1[[2]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a1$width <- width_ciopt_a1$upper_ci - width_ciopt_a1$lower_ci
res_report_H1$width_ci_a1[11] <- mean(width_ciopt_a1$width)
width_ciopt_a2 <- list_res_mams_H1[[2]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a2$width <- width_ciopt_a2$upper_ci - width_ciopt_a2$lower_ci
res_report_H1$width_ci_a2[11] <- mean(width_ciopt_a2$width)
# boxplot(width_ciopt_a1$width-width_ciopt_a2$width)
# H0
width_ciopt_a1 <- list_res_mams_H0[[2]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a1$width <- width_ciopt_a1$upper_ci - width_ciopt_a1$lower_ci
res_report_H0$width_ci_a1[11] <- mean(width_ciopt_a1$width)
width_ciopt_a2 <- list_res_mams_H0[[2]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_ciopt_a2$width <- width_ciopt_a2$upper_ci - width_ciopt_a2$lower_ci
res_report_H0$width_ci_a2[11] <- mean(width_ciopt_a2$width)
# sqrt allocation
# H1
width_cisqrt_a1 <- list_res_mams_H1[[3]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a1$width <- width_cisqrt_a1$upper_ci - width_cisqrt_a1$lower_ci
res_report_H1$width_ci_a1[12] <- mean(width_cisqrt_a1$width)
width_cisqrt_a2 <- list_res_mams_H1[[3]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a2$width <- width_cisqrt_a2$upper_ci - width_cisqrt_a2$lower_ci
res_report_H1$width_ci_a2[12] <- mean(width_cisqrt_a2$width)
# H0
width_cisqrt_a1 <- list_res_mams_H0[[3]] %>% filter(arm == "a1") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a1$width <- width_cisqrt_a1$upper_ci - width_cisqrt_a1$lower_ci
res_report_H0$width_ci_a1[12] <- mean(width_cisqrt_a1$width)
width_cisqrt_a2 <- list_res_mams_H0[[3]] %>% filter(arm == "a2") %>% select(lower_ci, upper_ci, treat_effect)
width_cisqrt_a2$width <- width_cisqrt_a2$upper_ci - width_cisqrt_a2$lower_ci
res_report_H0$width_ci_a2[12] <- mean(width_cisqrt_a2$width)
##########################################
# summary tables
# res_report_H1table <- df_res %>% filter(H0=="FALSE") #%>% select(rt_a1,rt_a2,var_e1,var_e2,r1,r2,alloc,minrt,design)
table_H1 <- res_report_H1[c(9, 5:7, 1:2, 10:11, 3:4)]
knitr::kable(table_H1, format = "latex", caption = c("Power comparisons"), col.names = c("Design", "r1","r2", "Allocation", "Power A1","Power A2", "CI Width A1", "CI Width A2", "Variance A1", "Variance A2"), digits=3)
# res_report_H0table <- df_res %>% filter(H0=="TRUE") %>% select(rt_a1,rt_a2,var_e1,var_e2,r1,r2,alloc,minrt,design)
table_H0 <- res_report_H0[c(9, 5:7, 1:2, 10:11, 3:4)]
knitr::kable(table_H0, format = "latex", caption = c("Type 1 error rate comparisons"), col.names = c("Design",  "r1","r2", "Allocation", "T1E A1","T1E A2","CI Width A1", "CI Width A2", "Variance A1", "Variance A2"), digits=3)
